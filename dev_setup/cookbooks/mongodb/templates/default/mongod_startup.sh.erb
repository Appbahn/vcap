#!/bin/bash
for n in `seq 1 100`; do
  if [ -f /tmp/vcap_chown.out ]; then
    break
  fi
  sleep 0.1
done

touch /store/log/mongodb.log
mkdir -p /store/instance/data

if [ $# -eq 0 ]; then
  exit 1
fi

# mongod_startup.sh 1.8
# mongod_startup.sh 1.8 --journal
# mongod_startup.sh 2.0
# mongod_startup.sh 2.0 --nojournal
version=$1
if [ ${version} = "1.8" ]; then
  params="--journal"
elif [ ${version} = "2.0" ]; then
  params="--nojournal"
fi

arguments=""
shift
while [ $# -ne 0 ]; do
  for i in $params; do
    if [ $1 = $i ]; then
      arguments="$arguments $1"
    fi
  done
  shift
done

exec /usr/share/mongodb/mongodb-${version}/mongod $arguments --config /etc/mongodb.conf
