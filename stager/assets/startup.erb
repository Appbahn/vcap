#!/bin/bash

# NB: Everything here is executing _inside_ the container

<% for name, val in environment_variables %>
export <%= name %>=<%= val %>
<% end %>

# Sets globbing behavior such that globs matching nothing evaluate to null
# rather than themselves. This prevents the feature_start glob below from
# evaluating to itself when no feature start scripts exist.
shopt -s nullglob

# Execute all the features' start scripts
for f in "${PWD}/vcap/script/feature_start/*"
do
  ${f} $@
done

# VCAP stop script expects the presence of this file
echo $PPID > parent.pid

./framework_start $@ > ./logs/stdout.log 2> ./logs/stderr.log &
wait $!